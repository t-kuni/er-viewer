# ER Diagram Viewer

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

RDBã‹ã‚‰ERå›³ã‚’ãƒªãƒãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§è¦–è¦šçš„ã«è¡¨ç¤ºãƒ»ç·¨é›†ã§ãã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

## ã‚»ãƒ«ãƒ•ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«

ä»¥ä¸‹ã«è¨˜è¼‰ã®ã†ã¡ã€ğŸ’¡ã®çµµæ–‡å­—ãŒã‚ã‚‹é …ç›®ã¯å¿˜ã‚Œãªã„ã‚ˆã†ã«æ¯å›å‡ºåŠ›ã—ã¦ãã ã•ã„

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Node.js + Express + MySQL2
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: TypeScript + Vanilla JavaScript (ES6 modules) + SVG
- **ãƒ†ã‚¹ãƒˆ**: Jest + ts-jest + jsdom (E2Eé¢¨çµ±åˆãƒ†ã‚¹ãƒˆ)
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: Docker + Docker Compose
- **é–‹ç™ºãƒ„ãƒ¼ãƒ«**: ESLint + Prettier + TypeScript

## é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
docker compose up -d

# ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
docker compose ps
```

## åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ†ã‚¹ãƒˆ
npm test                       # å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

# TypeScript
npm run build:ts               # TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
npm run dev:ts                 # TypeScript watchãƒ¢ãƒ¼ãƒ‰
npm run typecheck              # å‹ãƒã‚§ãƒƒã‚¯ã®ã¿å®Ÿè¡Œ

# å“è³ªãƒã‚§ãƒƒã‚¯
npm run lint                   # ESLintå®Ÿè¡Œ
npm run lint:fix               # ESLintè‡ªå‹•ä¿®æ­£
npm run format                 # Prettierãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
npm run format:check           # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯

# ä¿å­˜æ¸ˆã¿ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ‡ãƒ¼ã‚¿å‰Šé™¤
rm -f ./data/*
```

## é–‹ç™ºãƒ•ãƒ­ãƒ¼

1. **è¦ä»¶ç¢ºèª**: SPEC.mdã®è¦ä»¶ã‚’æº€ãŸã™ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’é–‹ç™º
2. **ã‚¿ã‚¹ã‚¯å®Œäº†æ¡ä»¶**: `npm test` ãŒé€šã‚‹ã“ã¨
3. **å‹•ä½œç¢ºèª**: ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆPlaywrightï¼‰ã‚’ä½¿ç”¨ï¼ˆcurlã¯éæ¨å¥¨ï¼‰
   - æ¥ç¶šå…ˆï¼š localhost:30033
   - ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆæ™‚ã¯å¿…ãšãƒ–ãƒ©ã‚¦ã‚¶ã‚’å†èµ·å‹•
4. **å·®åˆ†ç¢ºèª**: `git add -A && GIT_PAGER=cat git diff HEAD`

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ–¹é‡

### çµ±åˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆ

- **å˜ä¸€è²¬ä»»ã®çµ±åˆã‚¯ãƒ©ã‚¹**: `ERViewerApplication`ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’ç®¡ç†
- **ä¸­å¤®é›†æ¨©çš„çŠ¶æ…‹ç®¡ç†**: å…¨çŠ¶æ…‹ã‚’å˜ä¸€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ç®¡ç†ï¼ˆ`this.state`ï¼‰
- **ä¾å­˜æ€§æ³¨å…¥**: Infrastructureå±¤ã‚’ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§æ³¨å…¥
- **å‰¯ä½œç”¨ã®å®Œå…¨åˆ†é›¢**: å…¨ã¦ã®å‰¯ä½œç”¨ã‚’Infrastructureå±¤ã«å§”è­²

### Infrastructureå±¤ã«ã‚ˆã‚‹å‰¯ä½œç”¨éš”é›¢

- **Interface-Implementation-Mockä¸‰å±¤æ§‹é€ **
- **å®Œå…¨ãªæŠ½è±¡åŒ–**: DOMã€Networkã€Storageã€BrowserAPIæ“ä½œã‚’æŠ½è±¡åŒ–
- **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: Mockå®Ÿè£…ã«ã‚ˆã‚Šé«˜é€Ÿã§ä¿¡é ¼æ€§ã®é«˜ã„ãƒ†ã‚¹ãƒˆã‚’å®Ÿç¾

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
/public/js/
â”œâ”€â”€ app-new.ts                          # ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆæœ¬ç•ªç”¨ï¼‰
â”œâ”€â”€ er-viewer-application.ts            # çµ±åˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ï¼ˆ1539è¡Œï¼‰
â”œâ”€â”€ types/                              # TypeScriptå‹å®šç¾©
â”‚   â”œâ”€â”€ index.ts                        # åŸºæœ¬å‹å®šç¾©ï¼ˆERDataã€Entityç­‰ï¼‰
â”‚   â”œâ”€â”€ dom.ts                          # DOMé–¢é€£å‹å®šç¾©
â”‚   â”œâ”€â”€ events.ts                       # ã‚¤ãƒ™ãƒ³ãƒˆé–¢é€£å‹å®šç¾©
â”‚   â””â”€â”€ infrastructure.ts               # Infrastructureå±¤å‹å®šç¾©
â””â”€â”€ infrastructure/                     # å‰¯ä½œç”¨ç®¡ç†å±¤
    â”œâ”€â”€ interfaces/                     # æŠ½è±¡ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
    â”‚   â”œâ”€â”€ infrastructure.js           # çµ±åˆã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹
    â”‚   â”œâ”€â”€ dom-interface.js            # DOMæ“ä½œæŠ½è±¡åŒ–
    â”‚   â”œâ”€â”€ network-interface.js        # HTTPé€šä¿¡æŠ½è±¡åŒ–
    â”‚   â”œâ”€â”€ storage-interface.js        # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æŠ½è±¡åŒ–
    â”‚   â””â”€â”€ browser-api-interface.js    # ãƒ–ãƒ©ã‚¦ã‚¶APIæŠ½è±¡åŒ–
    â”œâ”€â”€ implementations/                # å®Ÿè£…ã‚¯ãƒ©ã‚¹ï¼ˆæœ¬ç•ªç”¨ï¼‰
    â”‚   â”œâ”€â”€ infrastructure-implementation.js
    â”‚   â”œâ”€â”€ dom-implementation.js
    â”‚   â”œâ”€â”€ network-implementation.js
    â”‚   â”œâ”€â”€ storage-implementation.js
    â”‚   â””â”€â”€ browser-api-implementation.js
    â””â”€â”€ mocks/                          # ãƒ†ã‚¹ãƒˆç”¨ãƒ¢ãƒƒã‚¯å®Ÿè£…
        â”œâ”€â”€ infrastructure-mock.js
        â”œâ”€â”€ dom-mock.js
        â”œâ”€â”€ network-mock.js
        â”œâ”€â”€ storage-mock.js
        â””â”€â”€ browser-api-mock.js

/tests/
â”œâ”€â”€ initialization-setup.test.ts        # åˆæœŸåŒ–ã¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ rendering.test.ts                    # ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ user-interaction.test.ts             # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ data-management.test.ts              # ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã®ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ ui-components.test.ts                # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ state-management.test.ts             # çŠ¶æ…‹ç®¡ç†ã®ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ error-handling.test.ts               # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ
â””â”€â”€ test-data-factory.ts                 # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼

/lib/                                   # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”œâ”€â”€ database.js                         # MySQLæ“ä½œ
â”œâ”€â”€ storage.js                          # ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
â””â”€â”€ logger.js                           # ãƒ­ã‚°ç®¡ç†
```

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### E2Eé¢¨çµ±åˆãƒ†ã‚¹ãƒˆè¨­è¨ˆ

- **æ©Ÿèƒ½åˆ¥ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: å¤§é …ç›®ã”ã¨ã«åˆ†é›¢ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
- **Infrastructureå±¤ã®ã¿ãƒ¢ãƒƒã‚¯**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

- **initialization-setup.test.ts**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã€ã‚­ãƒ£ãƒ³ãƒã‚¹è¨­å®šã€åˆæœŸãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰
- **rendering.test.ts**: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æç”»ã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—æç”»ã€ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆæ“ä½œã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
- **user-interaction.test.ts**: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é¸æŠã€ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã€æ³¨é‡ˆè¿½åŠ 
- **data-management.test.ts**: ãƒ‡ãƒ¼ã‚¿å–å¾—ã€æ°¸ç¶šåŒ–ã€ãƒªãƒãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
- **ui-components.test.ts**: ãƒ˜ãƒ«ãƒ—ãƒ‘ãƒãƒ«ã€ã‚µã‚¤ãƒ‰ãƒãƒ¼ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
- **state-management.test.ts**: çŠ¶æ…‹å¤‰æ›´é€šçŸ¥ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç›£è¦–ã€ãƒ’ã‚¹ãƒˆãƒªãƒ¼ç®¡ç†
- **error-handling.test.ts**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã€ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼

### ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ï¼ˆğŸ’¡ï¼‰

- **AAAãƒ‘ã‚¿ãƒ¼ãƒ³å³å®ˆ**: Arrangeï¼ˆæº–å‚™ï¼‰ã€Actï¼ˆå®Ÿè¡Œï¼‰ã€Assertï¼ˆæ¤œè¨¼ï¼‰ã®3ã‚¹ãƒ†ãƒƒãƒ—ã‚’æ˜ç¢ºã«åˆ†é›¢
  - Actã§ERViewerApplicationã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™
  - Assertã§Mockã®å¼•æ•°ã¨å‘¼ã³å‡ºã—å›æ•°ã‚’æ¤œè¨¼ã™ã‚‹
- **å¯èª­æ€§æœ€å„ªå…ˆ**: DRYåŸå‰‡ã‚ˆã‚Šã‚‚ãƒ†ã‚¹ãƒˆã®å¯èª­æ€§ã‚’é‡è¦–ã€‚å…±é€šåŒ–ã‚ˆã‚Šã‚‚ãƒªãƒ†ãƒ©ãƒ«å€¤ã®ç›´æ¥è¨˜è¿°
- **åˆ¶å¾¡æ§‹é€ æ’é™¤**: if/for/switchæ–‡ã‚’ä½¿ç”¨ç¦æ­¢ã€‚é…åˆ—æ“ä½œã‚„æ¡ä»¶åˆ†å²ã‚’é¿ã‘ã‚‹
- **Mockæ¤œè¨¼ä¸­å¿ƒ**: stateã‚’æ¤œè¨¼ã™ã‚‹ã®ã¯NGã€‚Infrastructure Mockã®å‘¼ã³å‡ºã—å±¥æ­´ã‚’æ¤œè¨¼ã™ã‚‹

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ç‰¹å¾´

- **é«˜é€Ÿå®Ÿè¡Œ**: ãƒ–ãƒ©ã‚¦ã‚¶ã‚„å¤–éƒ¨ä¾å­˜ãªã—ã§å®Ÿè¡Œ
- **æ±ºå®šçš„å‹•ä½œ**: ãƒ¢ãƒƒã‚¯ã«ã‚ˆã‚Šå¸¸ã«åŒã˜çµæœã‚’ä¿è¨¼
- **åŒ…æ‹¬çš„æ¤œè¨¼**: Infrastructure Mockã®å‘¼ã³å‡ºã—å±¥æ­´ã‚’å…¨ã¦æ¤œè¨¼
- **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è€æ€§**: å®Ÿè£…è©³ç´°ã§ãªãå‹•ä½œã‚’ãƒ†ã‚¹ãƒˆ

### ãƒ¢ãƒƒã‚¯æˆ¦ç•¥

```typescript
// ãƒ†ã‚¹ãƒˆä¾‹ï¼šAAAãƒ‘ã‚¿ãƒ¼ãƒ³ã¨Mockæ¤œè¨¼ã‚’ä½¿ç”¨
test('ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
  // Arrange
  const infrastructure = new InfrastructureMock();
  const app = new ERViewerApplication(infrastructure);
  
  // Act
  app.showTableDetails('users');
  
  // Assert - Mockå‘¼ã³å‡ºã—ã‚’æ¤œè¨¼
  expect(infrastructure.dom.setAttribute).toHaveBeenCalledWith(
    'sidebar', 
    'data-visible', 
    'true'
  );
  expect(infrastructure.dom.setTextContent).toHaveBeenCalledWith(
    'current-table', 
    'users'
  );
});
```

